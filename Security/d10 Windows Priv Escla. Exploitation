https://sec.cybbh.io/public/security/latest/lessons/lesson-9-windows-exploit_sg.html
https://git.cybbh.space/sec/public/-/jobs/842473/artifacts/external_file/slides/09-windows-priv-persist-cover.html
check out ExploitDB

check for port 3389, if its there, you can RDP

TAKEAWAYS
  Scheduled Tasks                            -Runs when triggered
  Services                                   -Runs on Startup, force restart
  Registry -> HKLM/.../currentversion/run    -Runs on Boot   , force restart
              HKCU                           -Runs on User Login, force restart
    **All ran by user System, highest level user**

DLL SEARCH ORDER ******#important
reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs"
Executables check the following locations (in successive order):
  HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs
  The directory the the Application was run from
  The directory specified in in the C+ function GetSystemDirectory()  
  The directory specified in the C+ function GetWindowsDirectory()
  The current directory
g
INTEGRITY LEVELS and USER ACCOUNT CONTROL (UAC)
There are six possible integrity levels:
    Untrusted - Anonymous SID access tokens
    Low - Everyone SID access token (World)
    Medium - Authenticated Users
    High - Administrators
    System - System services (LocalSystem, LocalService, NetworkService)
    Installer - Used by setup programs to install software.
*can be seen in a program such as Process Explorer

  UAC
    Always Notify
    Notify me only when programs try to make changes to my computer
    Notify me only when programs try to make changes to my computer (do not dim my desktop)
    Never notify
  reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System

----------------------------
PRIVILEGE ESCALATION

Scheduled Tasks & Services
    Write Permissions
    Non-Standard Locations
    Unquoted Executable Paths
    Vulnerabilities in Executables
    Permissions to Run As SYSTEM

schtasks /query /fo LIST /v                    -finding  vulnerable Scheduled Tasks

DLL Hijacking
    Identify Vulnerability
    Take advantage of the default search order for DLLs
    NAME_NOT_FOUND present in executableâ€™s system calls
    Validate permissions
    Create and transfer Malicious DLL
***SEE DLL search order

VULNERABLE SERVICES
wmic service list full
sc query

    Identify Vulnerability
    Validate permissions
    Validate Executable Paths
    Replace with Malicious File

PERSISTENCE
  check on
    Scheduled Tasks
    Registry
    Services
    
REGISTRY
  HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\    -on boot
    \Run or \RunOnce
  HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\     -on login of that user
    \Run or \RunOnce


question about logs?
  google it and go to a microsoft page

AUDIT LOGGING
auditpol /get /category:* | findstr /i "success failure"
  ****IMPORTANT
  ^^^ must have admin priv to run this  ^^^

Microsoft Event IDs  (security logs)
EventID     Description
4624/4625   successful/failed login
4720        account created
4672        administrator equivalent user logs on
7045        Service creation

Storage: c:\windows\system32\config\
File-Type: .evtx/.evt
wevtutil el
wmic ntevent where "logfile="<LOGNAME>" list full
Get-Eventlog -List

if something is running as a powershell script, probaby bad
powershell -command "$psversiontable"
reg query hklm\software\microsoft\powershell\3\powershellengine\

encoding
  base64 or rot13



In WinOps
run mmc
  Event Viewer
  Services
  Task Scheduler

process monitor
  filter
    process name > contains > (name)
    Result       >   is     > NAME NOT FOUND
    PATH         > contains > dll





priv code : msfvenom


